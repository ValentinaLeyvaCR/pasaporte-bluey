<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasaporte de Aventuras Bluey</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- Configuración Global --- */
        body, html {
            margin: 0; padding: 0; font-family: 'Nunito', sans-serif; /* Nueva fuente */
            overflow: hidden; height: 100%; background-color: #e3f2fd; /* Azul cielo muy claro */
            touch-action: manipulation; color: #37474f; /* Gris azulado */
        }

        /* --- Contenedor de Páginas --- */
        .page {
            width: 100%; height: 100vh; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s ease; visibility: hidden; opacity: 0; padding: 20px; box-sizing: border-box; line-height: 1.6;
            background-color: #e3f2fd; /* Azul cielo */
        }
        
        /* Patrón sutil de huellas */
        body {
             background-image: 
                 radial-gradient(circle at 10px 10px, rgba(128, 128, 128, 0.1) 1px, transparent 1px),
                 radial-gradient(circle at 50px 50px, rgba(128, 128, 128, 0.1) 1px, transparent 1px);
             background-size: 60px 60px;
        }

        .page.active { visibility: visible; opacity: 1; }
        
        h1 { font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 2.8em; color: #0277bd; /* Azul Bluey */ text-align: center; text-shadow: 1px 1px #fff; margin-bottom: 10px;}
        p { font-size: 1.3em; text-align: center; color: #ff6f00; /* Naranja */ font-weight: 700; margin-top: 5px; }

        /* --- Botones Estilo Bluey --- */
        .bluey-button {
            background: linear-gradient(145deg, #ffb74d, #ffa726); /* Naranja */
            border: 3px solid #fb8c00; /* Naranja más oscuro */
            color: #fff;
            padding: 15px 30px; font-size: 1.2em; font-family: 'Nunito', sans-serif; font-weight: 800;
            border-radius: 50px; /* Muy redondeado */
            cursor: pointer; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15); transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent; width: 90%; max-width: 320px; text-align: center; margin-bottom: 15px;
        }
        .bluey-button:hover { 
            background: linear-gradient(145deg, #ffcc80, #ffb74d); 
            transform: translateY(-2px); 
            box-shadow: 0 7px 12px rgba(0, 0, 0, 0.2); 
        }
        .bluey-button:active { transform: translateY(1px); box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1); }
        a.bluey-button { text-decoration: none; box-sizing: border-box; }

        @keyframes fadeIn { to { opacity: 1; } }
        
        /* --- Página 1: Bienvenida --- */
        #page-bienvenida { background-color: #a5d6a7; /* Verde Césped */ }
        #page-bienvenida h1 { color: #fff; text-shadow: 2px 2px #388e3c; } /* Verde oscuro */
        #page-bienvenida p { color: #fff; text-shadow: 1px 1px #388e3c; }
        #page-bienvenida .animated-message { font-size: 1.4em; color: #fff; opacity: 0; animation: fadeIn 2s ease 1s forwards; }
        
        /* --- Página 2: Portada (Logo) --- */
        #page-portada { background-color: #fff9c4; /* Amarillo Pálido */ }
        #page-portada h1 { color: #f57f17; } /* Amarillo oscuro */
        #page-portada .logo { width: 250px; max-width: 80%; border-radius: 10px; margin-bottom: 20px; background: #fff; padding:10px; box-shadow: 0 0 15px rgba(255,111,0,0.4); }

        /* --- Página 3: Historia (Bluey) --- */
        #page-historia { overflow-y: auto; justify-content: flex-start; background-color: #bbdefb; /* Azul más claro */ }
        #page-historia h1 { color: #0d47a1;} /* Azul oscuro */
        .historia-container { display: flex; flex-direction: column; gap: 20px; align-items: center; justify-content: flex-start; width: 100%; }
        .historia-container img { 
            width: 280px; max-width: 70%; margin-top: 10px; 
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.2));
        }
        .cuento-bloque { background: transparent; width: 90%; max-width: 500px; font-size: 1.2em; line-height: 1.5; text-align: center; }
        #page-historia .cuento-bloque p { color: #1e88e5; /* Azul medio */ font-weight: 700; }
        #page-historia .cuento-bloque strong { color: #ff6f00; /* Naranja */ }
        .historia-botones { margin-top: 15px; display: flex; flex-direction: column; gap: 15px; width: 100%; align-items: center; padding-bottom: 30px; }
        
        /* -- Ventana Sorpresa -- */
        #sorpresa-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 167, 38, 0.85); /* Naranja translúcido */ backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; visibility: hidden; opacity: 0; transition: all 0.3s ease; z-index: 100; padding: 20px; box-sizing: border-box; }
        #sorpresa-popup.active { visibility: visible; opacity: 1; }
        .sorpresa-content { position: relative; padding: 30px 20px; border: 4px solid #fff; border-radius: 20px; box-shadow: 0 0 30px rgba(0,0,0,0.3); text-align: center; width: 90%; max-width: 500px; background: #fb8c00; /* Naranja más oscuro */ }
        #typewriter-text { font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 1.8em; color: #fff; line-height: 1.4; text-shadow: 2px 2px #e65100; /* Naranja muy oscuro */ }
        .close-popup { position: absolute; top: 5px; right: 10px; font-size: 40px; color: #fff; cursor: pointer; background: none; border: none; width: auto; box-shadow: none; margin-bottom: 0; }
        
        /* -- Lluvia Bluey -- */
        @keyframes fall { 0% { top: -10%; transform: rotate(0deg); } 100% { top: 110%; transform: rotate(360deg); } }
        .bluey-rain { position: absolute; font-size: 2em; animation: fall linear infinite; top: -10%; opacity: 0.9; animation-duration: var(--animation-duration, 5s); animation-delay: var(--animation-delay, 0s); }

        /* --- Página 4: Cierre --- */
        #page-cierre { background-color: #ffe0b2; /* Naranja Pálido */ }
        #page-cierre h1 { color: #e65100; } /* Naranja oscuro */
        #page-cierre .logo { width: 200px; max-width: 70%; border-radius: 10px; background: #fff; padding:10px; box-shadow: 0 0 10px rgba(2,119,189,0.3); }
        #page-cierre .lema { font-size: 1.1em; color: #555; margin-top: 15px; font-weight: 400;}
        #page-cierre .frase-final { font-size: 1.6em; color: #0277bd; /* Azul Bluey */ font-family: 'Nunito', sans-serif; font-weight: 800; margin-top: 30px; margin-bottom: 30px; }
        
        /* --- PÁGINA 5: Certificado --- */
        #page-certificado { overflow-y: auto; justify-content: flex-start; background-color: #fff9c4; /* Amarillo Pálido */ }
        .certificado-content { width: 95%; max-width: 700px; background: #fff; border: 5px solid #0277bd; /* Borde Azul Bluey */ border-radius: 15px; padding: 20px; box-sizing: border-box; text-align: center; color: #37474f; margin-top: 20px; }
        .certificado-content h1 { color: #0277bd; font-size: 1.8em; text-shadow: none; border-bottom: 2px dashed #ffb74d; padding-bottom: 10px; }
        .certificado-body { font-size: 1.2em; line-height: 1.8; margin-top: 20px; margin-bottom: 30px; font-weight: 700; }
        .campo-rellenable { font-weight: 800; color: #e65100; /* Naranja oscuro */ background: #fff9c4; padding: 2px 8px; border-radius: 5px; border-bottom: 1px solid #e65100; display: inline-block; margin: 0 3px;}
        /* >> NUEVA CLASE PARA TEXTO FIJO << */
        .campo-static { 
            font-weight: 800; 
            color: #0277bd; /* Azul Bluey */ 
            /* Opcional: background: #e3f2fd; padding: 2px 6px; border-radius: 5px; */
        } 
        
    </style>
</head>
<body>

    <div id="page-bienvenida" class="page active">
        <h1>¡G'day!</h1>
        <p class="animated-message">¿Listo para jugar?</p>
        <button id="btn-comenzar" class="bluey-button">🎾 ¡Vamos!</button>
    </div>

    <div id="page-portada" class="page">
        <img src="logo.png" alt="Logo Trapo de Luz" class="logo"> 
        <h1>Pasaporte de Aventuras</h1>
        <button id="btn-entrar" class="bluey-button">¡Empezar!</button>
    </div>

    <div id="page-historia" class="page">
        <div class="historia-container">
            <img src="bluey.png" alt="Bluey"> 
            <div class="cuento-bloque">
                <p>¡Hooray! ¡Soy yo!</p>
                <p>¿Jugamos a algo?</p>
            </div>
        </div>
        <div class="historia-botones">
            <button id="btn-certificado" class="bluey-button">📜 Certificado Familiar</button>
            <button id="btn-sorpresa" class="bluey-button">✨ ¡Garra Mágica!</button>
            <a href="https://www.instagram.com/trapodeluz/" target="_blank" class="bluey-button">📸 Ver Amigos</a>
        </div>
    </div>

    <div id="page-cierre" class="page">
        <img src="logo.png" alt="Logo Trapo de Luz" class="logo"> 
        <p class="lema">"Cada trapo, una historia; cada historia, una sonrisa."</p>
        <p class="frase-final">¿De verdad? ¡Oh, galletas!<br>¡Nos vemos pronto!</p>
        <button id="btn-inicio" class="bluey-button">🏠 Volver al Inicio</button>
    </div>

    <div id="page-certificado" class="page">
        <div class="certificado-content">
            <h1>Certificado Oficial</h1>
            <h2>de Diversión Familiar Heeler</h2>
            <div class="certificado-body">
                ¡Por mis barbas azules!<br>
                Se certifica que<br>
                <span class="campo-rellenable" id="cert-nombre">[Nombre]</span>
                <br>es ahora compañero de juegos oficial de<br>
                <span class="campo-static">Bluey</span>
                <br>desde el día <span class="campo-rellenable" id="cert-fecha">[Fecha]</span>.
                <br><br>
                ¡Prepárense para muchas aventuras!
            </div>
            <button id="btn-volver-historia" class="bluey-button">Volver</button>
        </div>
    </div>

    <div id="sorpresa-popup">
        <div id="bluey-rain-container"></div>
        <div class="sorpresa-content">
            <button class="close-popup" id="btn-cerrar-popup">&times;</button>
            <div id="typewriter-text"></div>
        </div>
    </div>

    <audio id="sound-background" src="bluey_fondo.mp3" loop preload="auto"></audio>
    <audio id="sound-magic" src="bluey_magia.mp3" preload="auto"></audio>
    <audio id="sound-click" src="bluey_click.mp3" preload="auto"></audio>
    <audio id="sound-bounce" src="bluey_rebote.mp3" preload="auto"></audio>


    <script>
        // --- Referencias a Elementos ---
        const pages = document.querySelectorAll('.page');
        const btnComenzar = document.getElementById('btn-comenzar');
        const btnEntrar = document.getElementById('btn-entrar');
        const btnSorpresa = document.getElementById('btn-sorpresa');
        const btnInicio = document.getElementById('btn-inicio');
        const btnCerrarPopup = document.getElementById('btn-cerrar-popup');
        const popup = document.getElementById('sorpresa-popup');
        const btnCertificado = document.getElementById('btn-certificado');
        const btnVolverHistoria = document.getElementById('btn-volver-historia');
        
        const soundMagic = document.getElementById('sound-magic');
        const soundClick = document.getElementById('sound-click');
        const soundBounce = document.getElementById('sound-bounce');
        const soundBackground = document.getElementById('sound-background');
        
        // --- Variables de Estado ---
        let audioUnlocked = false;
        
        // --- Funciones de Audio ---
        function unlockAllAudio() {
            console.log("Intentando desbloquear audio...");
            if (audioUnlocked) { console.log("Audio ya desbloqueado."); return Promise.resolve(); }
            const allSounds = [soundMagic, soundClick, soundBounce, soundBackground];
            const promises = []; 
            allSounds.forEach(sound => {
                if (!sound) { console.error("Error: Elemento de audio no encontrado."); return; }
                const promise = sound.play()
                    .then(() => { sound.pause(); sound.currentTime = 0; console.log(`Audio ${sound.id} desbloqueado.`); })
                    .catch(error => { console.warn(`No se pudo desbloquear ${sound.id}. Error: ${error.message}`); });
                promises.push(promise);
            });
            return Promise.allSettled(promises).then(() => {
                audioUnlocked = true;
                console.log("Desbloqueo de audio completado.");
                if (soundBackground && soundBackground.paused) {
                    soundBackground.volume = 0.4; /* Volumen alegre */
                    soundBackground.play().catch(e => console.error("Error al iniciar música de fondo:", e.message));
                }
            });
        }
        
        function playSound(sound, reset = true) {
            console.log(`Intentando reproducir ${sound ? sound.id : 'sonido nulo'}`);
            if (!audioUnlocked) { console.log("Audio no desbloqueado, reproducción cancelada."); return; }
            if (!sound) { console.error("Error: Intentando reproducir un sonido que no existe."); return; }
            sound.play()
                .then(() => { if (reset) { sound.currentTime = 0; } console.log(`Reproduciendo ${sound.id}`); })
                .catch(error => { console.error(`Error al reproducir ${sound.id}: ${error.message}`); });
        }
        
        // --- Función de Navegación ---
        function goToPage(pageId) {
            console.log(`Navegando a: ${pageId}`);
            pages.forEach(page => { page.classList.remove('active'); });
            const newPage = document.getElementById(pageId);
            if (newPage) { newPage.classList.add('active'); newPage.scrollTop = 0; console.log(`Página ${pageId} activada.`); } 
            else { console.error(`Error: No se encontró la página con ID ${pageId}`); }
        }

        // --- Event Listeners ---
        if (btnComenzar) {
            btnComenzar.addEventListener('click', (e) => {
                e.stopPropagation(); console.log("Botón Comenzar clickeado.");
                unlockAllAudio().then(() => {
                     if(audioUnlocked) playSound(soundMagic); 
                     setTimeout(() => { goToPage('page-portada'); }, 100); 
                });
            });
        } else { console.error("Error: Botón 'btn-comenzar' no encontrado."); }

        if (btnEntrar) { btnEntrar.addEventListener('click', (e) => { e.stopPropagation(); playSound(soundClick); goToPage('page-historia'); }); } 
        else { console.error("Error: Botón 'btn-entrar' no encontrado."); }

        if (btnInicio) { btnInicio.addEventListener('click', (e) => { e.stopPropagation(); playSound(soundBounce); goToPage('page-bienvenida'); }); } 
        else { console.error("Error: Botón 'btn-inicio' no encontrado."); }

        if (btnSorpresa) {
            btnSorpresa.addEventListener('click', (e) => {
                e.stopPropagation(); playSound(soundMagic);
                if (popup) popup.classList.add('active'); else console.error("Popup no encontrado");
                startBlueyRain();
                const textoSorpresa = "¡La Garra Mágica tiene algo para ti!... ¡Es un GRAN WACKADOO! 🎉 ¡Diviértete mucho!";
                startTypewriter(textoSorpresa, 'typewriter-text');
            });
        } else { console.error("Error: Botón 'btn-sorpresa' no encontrado."); }

        if (btnCerrarPopup) { btnCerrarPopup.addEventListener('click', (e) => { e.stopPropagation(); if (popup) popup.classList.remove('active'); stopBlueyRain(); }); } 
        else { console.error("Error: Botón 'btn-cerrar-popup' no encontrado."); }
        
        // >> JAVASCRIPT SIMPLIFICADO <<
        function popularCertificado() {
            const urlParams = new URLSearchParams(window.location.search);
            const nombre = urlParams.get('nombre'); 
            const fecha = urlParams.get('fecha');
            const elNombre = document.getElementById('cert-nombre'); 
            const elFecha = document.getElementById('cert-fecha');
            // 'muneco' ya no se busca ni se usa aquí
            if (elNombre) { if (nombre) { elNombre.textContent = nombre; } else { elNombre.textContent = "[Nombre]"; } } else { console.error("Elemento cert-nombre no encontrado"); }
            if (elFecha) { if (fecha) { elFecha.textContent = fecha; } else { elFecha.textContent = "[Fecha]"; } } else { console.error("Elemento cert-fecha no encontrado"); }
        }
        
        if (btnCertificado) { btnCertificado.addEventListener('click', (e) => { e.stopPropagation(); playSound(soundClick); popularCertificado(); goToPage('page-certificado'); }); } 
        else { console.error("Error: Botón 'btn-certificado' no encontrado."); }

        if (btnVolverHistoria) { btnVolverHistoria.addEventListener('click', (e) => { e.stopPropagation(); playSound(soundClick); goToPage('page-historia'); }); } 
        else { console.error("Error: Botón 'btn-volver-historia' no encontrado."); }
        
        /* --- Funciones de Efectos --- */
        function startTypewriter(txt, elementId) { let i = 0; const speed = 90; const target = document.getElementById(elementId); if (!target) { console.error(`Elemento ${elementId} no encontrado para typewriter`); return; } target.innerHTML = ''; function type() { if (txt.substring(i, i + 4).toLowerCase() === '<br>') { target.innerHTML += '<br>'; i += 4; } if (i < txt.length) { target.innerHTML += txt.charAt(i); i++; setTimeout(type, speed); } } type(); }
        
        // Lluvia Bluey (Pelotas, Estrellas, Huesos)
        const rainContainer = document.getElementById('bluey-rain-container'); 
        let rainInterval; 
        const rainChars = ['🎾', '⭐', '🦴', '✨']; 

        function startBlueyRain() { 
            console.log("Iniciando lluvia Bluey"); 
            stopBlueyRain(); 
            rainInterval = setInterval(createRainElement, 150); 
        }
        function stopBlueyRain() { 
            console.log("Deteniendo lluvia Bluey"); 
            clearInterval(rainInterval); 
            if (rainContainer) { rainContainer.innerHTML = ''; } 
        }
        function createRainElement() { 
            const element = document.createElement('div'); 
            element.classList.add('bluey-rain'); 
            element.innerText = rainChars[Math.floor(Math.random() * rainChars.length)];
            element.style.left = Math.random() * 100 + 'vw'; 
            element.style.setProperty('--animation-duration', (Math.random() * 3) + 4 + 's'); 
            element.style.setProperty('--animation-delay', Math.random() * 1.5 + 's'); 
            if (rainContainer) { rainContainer.appendChild(element); } 
            else { console.error("Contenedor 'bluey-rain-container' no encontrado"); return;} 
            setTimeout(() => { element.remove(); }, 7000); 
        }
        
        document.addEventListener('DOMContentLoaded', () => { console.log("DOM cargado. Bluey - Nombre Fijo listo."); });
    </script>
</body>
</html>
